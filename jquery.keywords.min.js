/*
  Keywords plugin for jQuery
	Copyright (c) 2013 Cedric Vanet (cedric-vanet.fr)
	Version: 0.1
*/

(function($){$.fn.keywords=function(options){var defauts={"min":4,"max":25,"words":50,"tag":null,"alertmid":40,"alertmax":true,"attachto":null,"callback":null};var parametres=$.extend(defauts,options);return this.each(function(){$(this).keyup(function(){var tabstrings=Array(),tabwords=Array(),text=$(this).val();parametres.attachto.val("").html("");if(parametres.tag){tabstrings=keywords_striptag(text,parametres.tag);}else{if(text!=""){tabstrings[0]=text;}else{tabstrings=null;}}tabstrings=keywords_striphtml(tabstrings);if(tabstrings!=null){tabwords=keywords_stripword(tabstrings,parametres.min,parametres.max,parametres.words);var nb_words=tabwords.length;tabwords=tabwords.join(';');if(parametres.attachto){parametres.attachto.val(tabwords).html(tabwords);}else{alert("\"Attachto\" not present in the parameters of the function, so result : \n\n"+tabwords);}}if(parametres.callback){parametres.callback();}});});};})(jQuery);function keywords_stripword(tab,min,max,words){var tabwords=new Array(),tabtemp=new Array();for(var i=0,taille=tab.length;i<taille;i++){tabtemp=tab[i].split(' ');for(var w=0,tailletemp=tabtemp.length;w<tailletemp;w++){if(tabwords.length==words){return tabwords;}if(tabtemp[w].length>=min&&tabtemp[w].length<=max){var regex=new RegExp("[àáâãäåçèéêëìíîïðòóôõöùúûüýÿ]+","gi");if(regex.test(tabtemp[w])){var new_word=keywords_del_accent(tabtemp[w]);if(!keywords_array_search(tabwords,new_word)){tabwords.push(new_word);}};if(!keywords_array_search(tabwords,tabtemp[w])){tabwords.push(tabtemp[w]);}}}}return tabwords;}function keywords_striptag(text,tag){var tagstart="<"+tag+">";var tagend="</"+tag+">";var tabtemp=new Array();var tabwords=new Array();var temp=null;tabtemp=text.split(tagend);var regex=new RegExp(tagstart+"[/\\w\\t\\n\\r\\sàáâãäåçèéêëìíîïðòóôõöùúûüýÿ\\-._'\\\\,\"\\(\\)\<\>]+","gi");for(var w=0,tailletemp=tabtemp.length;w<tailletemp;w++){temp=tabtemp[w].match(regex);if(temp!=null){tabwords.push(temp);}}if(tabwords==null){return null;}else{return tabwords;}}function keywords_striphtml(tab){var regex=new RegExp("(<([^>]+)>)","gi");var temp=new String();if(tab!=null){for(var i=0,taille=tab.length;i<taille;i++){temp=new String(tab[i]);temp=keywords_lowercase(temp);tab[i]=temp.replace(regex,"");}}return tab;}function keywords_array_search(tab,value){for(var i=0,taille=tab.length;i<taille;i++){if(tab[i]==value){return true;}}return false;}function keywords_del_accent(value){var new_value="",pattern_accent=new Array("à","á","â","ã","ä","å","ç","è","é","ê","ë","ì","í","î","ï","ð","ò","ó","ô","õ","ö","ù","ú","û","ü","ý","ÿ"),pattern_replace_accent=new Array("a","a","a","a","a","a","c","e","e","e","e","i","i","i","i","o","o","o","o","o","o","u","u","u","u","y","y");if(value&&value!=""){new_value=keywords_preg_replace(pattern_accent,pattern_replace_accent,value);}return new_value;}function keywords_preg_replace(array_pattern,array_pattern_replace,value){var new_value=String(value);for(var i=0,taille=array_pattern.length;i<taille;i++){var reg_exp=RegExp(array_pattern[i],"gi");var val_to_replace=array_pattern_replace[i];new_value=new_value.replace(reg_exp,val_to_replace);}return new_value;}function keywords_lowercase(text){return text.toLowerCase();}
